<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StockAI API ÏÉÅÌÉú</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5rem;
        }

        .status-summary {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .status-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #ddd;
        }

        .status-card.configured {
            border-left-color: #28a745;
            background: #d4edda;
        }

        .status-card.not-configured {
            border-left-color: #ffc107;
            background: #fff3cd;
        }

        .api-name {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 10px;
        }

        .api-description {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .api-features {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid rgba(0,0,0,0.1);
        }

        .feature-tag {
            display: inline-block;
            background: rgba(255,255,255,0.8);
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            margin: 2px;
        }

        .setup-button {
            margin-top: 10px;
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .setup-button:hover {
            background: #0056b3;
        }

        .progress-bar {
            background: #e9ecef;
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            background: linear-gradient(90deg, #28a745, #20c997);
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            transition: width 0.5s ease;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            background: white;
            width: 90%;
            max-width: 600px;
            margin: 50px auto;
            padding: 30px;
            border-radius: 15px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-close {
            float: right;
            font-size: 30px;
            cursor: pointer;
            color: #999;
        }

        .modal-close:hover {
            color: #333;
        }

        .setup-steps {
            margin: 20px 0;
        }

        .setup-step {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 3px solid #007bff;
        }

        .code-example {
            background: #2d3748;
            color: #48bb78;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            overflow-x: auto;
        }

        .data-quality {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .quality-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .quality-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }

        .quality-value {
            font-size: 1.2rem;
            font-weight: bold;
        }

        .quality-value.real-time {
            color: #28a745;
        }

        .quality-value.limited {
            color: #ffc107;
        }

        .quality-value.mock {
            color: #dc3545;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ StockAI API ÏÉÅÌÉú</h1>

        <div class="status-summary">
            <h2>API ÏÑ§Ï†ï ÌòÑÌô©</h2>
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar">0%</div>
            </div>

            <div class="data-quality">
                <div class="quality-item">
                    <div class="quality-label">Ï£ºÍ∞Ä Îç∞Ïù¥ÌÑ∞</div>
                    <div class="quality-value real-time" id="priceQuality">Ïã§ÏãúÍ∞Ñ</div>
                </div>
                <div class="quality-item">
                    <div class="quality-label">Îâ¥Ïä§ Îç∞Ïù¥ÌÑ∞</div>
                    <div class="quality-value limited" id="newsQuality">Ï†úÌïúÏ†Å</div>
                </div>
                <div class="quality-item">
                    <div class="quality-label">Ïû¨Î¨¥Ï†úÌëú</div>
                    <div class="quality-value mock" id="financialQuality">ÌïòÎìúÏΩîÎî©</div>
                </div>
                <div class="quality-item">
                    <div class="quality-label">Í∏∞Ïà†Ï†Å Î∂ÑÏÑù</div>
                    <div class="quality-value mock" id="technicalQuality">ÏòàÏ∏°Í∞í</div>
                </div>
            </div>

            <h3 style="margin-top: 30px;">ÏÑ§Ï†ïÎêú API</h3>
            <div class="status-grid" id="configuredApis"></div>

            <h3 style="margin-top: 30px;">ÏÑ§Ï†ï ÌïÑÏöî API</h3>
            <div class="status-grid" id="notConfiguredApis"></div>
        </div>
    </div>

    <!-- Setup Guide Modal -->
    <div id="setupModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle">API ÏÑ§Ï†ï Í∞ÄÏù¥Îìú</h2>
            <div id="modalContent"></div>
        </div>
    </div>

    <script>
        async function loadAPIStatus() {
            try {
                const response = await fetch('/api/status');
                const data = await response.json();

                if (data.success) {
                    const status = data.api_status;
                    const sources = data.data_sources;

                    // Progress bar
                    const percentage = Math.round((status.configured_count / status.total) * 100);
                    const progressBar = document.getElementById('progressBar');
                    progressBar.style.width = `${percentage}%`;
                    progressBar.textContent = `${percentage}% (${status.configured_count}/${status.total})`;

                    // Data quality
                    updateDataQuality(sources.data_quality);

                    // Configured APIs
                    const configuredContainer = document.getElementById('configuredApis');
                    configuredContainer.innerHTML = '';

                    if (status.configured.length === 0) {
                        configuredContainer.innerHTML = '<p style="color: #666;">ÏïÑÏßÅ ÏÑ§Ï†ïÎêú APIÍ∞Ä ÏóÜÏäµÎãàÎã§. Yahoo FinanceÎßå ÏÇ¨Ïö© Ï§ëÏûÖÎãàÎã§.</p>';
                    } else {
                        status.configured.forEach(apiName => {
                            const api = status.details[apiName];
                            configuredContainer.appendChild(createAPICard(apiName, api, true));
                        });
                    }

                    // Not configured APIs
                    const notConfiguredContainer = document.getElementById('notConfiguredApis');
                    notConfiguredContainer.innerHTML = '';

                    status.not_configured.forEach(apiName => {
                        const api = status.details[apiName];
                        notConfiguredContainer.appendChild(createAPICard(apiName, api, false));
                    });
                }
            } catch (error) {
                console.error('Failed to load API status:', error);
            }
        }

        function updateDataQuality(quality) {
            const qualityMap = {
                'Ïã§ÏãúÍ∞Ñ': 'real-time',
                'Ï†úÌïúÏ†Å': 'limited',
                'ÌïòÎìúÏΩîÎî©': 'mock',
                'ÏòàÏ∏°Í∞í': 'mock'
            };

            Object.entries(quality).forEach(([key, value]) => {
                let elementId;
                switch(key) {
                    case 'Ï£ºÍ∞Ä': elementId = 'priceQuality'; break;
                    case 'Îâ¥Ïä§': elementId = 'newsQuality'; break;
                    case 'Ïû¨Î¨¥Ï†úÌëú': elementId = 'financialQuality'; break;
                    case 'Í∏∞Ïà†Ï†ÅÎ∂ÑÏÑù': elementId = 'technicalQuality'; break;
                }

                if (elementId) {
                    const element = document.getElementById(elementId);
                    if (element) {
                        element.textContent = value;
                        element.className = 'quality-value ' + (qualityMap[value] || 'mock');
                    }
                }
            });
        }

        function createAPICard(apiName, api, isConfigured) {
            const card = document.createElement('div');
            card.className = `status-card ${isConfigured ? 'configured' : 'not-configured'}`;

            card.innerHTML = `
                <div class="api-name">
                    ${isConfigured ? '‚úÖ' : '‚ö†Ô∏è'} ${api.name}
                </div>
                <div class="api-description">${api.description}</div>
                <div class="api-features">
                    ${api.features.map(f => `<span class="feature-tag">${f}</span>`).join('')}
                </div>
                ${!isConfigured ? `<button class="setup-button" onclick="showSetupGuide('${apiName}')">ÏÑ§Ï†ï Í∞ÄÏù¥Îìú</button>` : ''}
            `;

            return card;
        }

        async function showSetupGuide(apiName) {
            try {
                const response = await fetch(`/api/setup-guide/${apiName}`);
                const data = await response.json();

                if (data.success) {
                    const guide = data.guide;
                    const modal = document.getElementById('setupModal');
                    const modalTitle = document.getElementById('modalTitle');
                    const modalContent = document.getElementById('modalContent');

                    modalTitle.textContent = `${guide.name} ÏÑ§Ï†ï Í∞ÄÏù¥Îìú`;

                    let content = '<div class="setup-steps">';
                    guide.steps.forEach(step => {
                        content += `<div class="setup-step">${step}</div>`;
                    });
                    content += '</div>';

                    if (guide.example) {
                        content += `<h3>ÌôòÍ≤ΩÎ≥ÄÏàò ÏòàÏãú</h3>`;
                        content += `<div class="code-example">${guide.example}</div>`;
                    }

                    modalContent.innerHTML = content;
                    modal.style.display = 'block';
                }
            } catch (error) {
                console.error('Failed to load setup guide:', error);
            }
        }

        function closeModal() {
            document.getElementById('setupModal').style.display = 'none';
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('setupModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }

        // Load status on page load
        loadAPIStatus();

        // Refresh every 30 seconds
        setInterval(loadAPIStatus, 30000);
    </script>
</body>
</html>